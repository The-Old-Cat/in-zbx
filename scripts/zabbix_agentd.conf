# This is a configuration file for Zabbix agent service (Windows)
# To get more information about Zabbix, visit https://www.zabbix.com  

############ GENERAL PARAMETERS #################

### Option: LogFile
#	Log file name for LogType 'file' parameter.
#
# Mandatory: no
# Default:
# LogFile=

# Путь к файлу журнала агента Zabbix
LogFile=C:\Program Files\Zabbix Agent\zabbix_agentd.log


### Option: EnableRemoteCommands - Deprecated, use AllowKey=system.run[*] or DenyKey=system.run[*] instead
#	Internal alias for AllowKey/DenyKey parameters depending on value:
#	0 - DenyKey=system.run[*]
#	1 - AllowKey=system.run[*]
#
# Mandatory: no

# Разрешает выполнение удаленных команд через Zabbix
AllowKey=system.run[*]

### Option: LogRemoteCommands
#	Enable logging of executed shell commands as warnings.
#	0 - disabled
#	1 - enabled
#
# Mandatory: no
# Default:
# LogRemoteCommands=0

# Включает логирование выполняемых команд (полезно для отладки)
LogRemoteCommands=1

##### Passive checks related

### Option: Server
#	List of comma delimited IP addresses, optionally in CIDR notation, or DNS names of Zabbix servers and Zabbix proxies.
#	Incoming connections will be accepted only from the hosts listed here.
#
# Mandatory: yes, if StartAgents is not explicitly set to 0
# Default:
# Server=

# Список Zabbix серверов, которые могут запрашивать данные с этого агента (пассивные проверки)
# 127.0.0.1 - локальный хост, 111.111.111.111 - основной Zabbix сервер
Server=127.0.0.1,111.111.111.111

### Option: ListenPort
#	Agent will listen on this port for connections from the server.
#
# Mandatory: no
# Range: 1024-32767
# Default:
# ListenPort=10050

# Порт не указан, используется порт по умолчанию 10050

### Option: ServerActive
#	Zabbix server/proxy address or cluster configuration to get active checks from.
#
# Mandatory: no
# Default:
# ServerActive=

# Адрес Zabbix сервера для активных проверок (агент сам отправляет данные)
ServerActive=111.111.111.111

### Option: Hostname
#	List of comma delimited unique, case sensitive hostnames.
#	Required for active checks and must match hostnames as configured on the server.
#
# Mandatory: no
# Default:
# Hostname=

# Имя хоста, которое должно совпадать с именем, настроенным на Zabbix сервере
Hostname=ИмяУзлаСети

############ ADVANCED PARAMETERS #################

### Option: Timeout
#	Specifies how long to wait (in seconds) for establishing connection and exchanging data with Zabbix proxy or server.
#
# Mandatory: no
# Range: 1-30
# Default:
# Timeout=3

# Увеличенный таймаут для операций (по умолчанию 3 секунды)
Timeout=30

####### USER-DEFINED MONITORED PARAMETERS #######

### Option: UnsafeUserParameters
#	Allow all characters to be passed in arguments to user-defined parameters.
#
# Mandatory: no
# Range: 0-1
# Default:

# Разрешает использование специальных символов в пользовательских параметрах
UnsafeUserParameters=1

### Option: UserParameter
#	User-defined parameter to monitor. There can be several user-defined parameters.
#	Format: UserParameter=<key>,<shell command>
#
# Mandatory: no
# Default:
# UserParameter=


### 1C MONITORING ###
# Пользовательские параметры для мониторинга 1С:Предприятие

# === 1C PROCESSES ===
# Обнаружение процессов 1С
UserParameter=1c.processes.discovery,powershell.exe -NoProfile -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\script\1c_processes.ps1" discovery
# Количество процессов 1С
UserParameter=1c.processes.count,powershell.exe -NoProfile -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\script\1c_processes.ps1" count
# Детальная информация о процессе 1С (параметры: тип, значение)
UserParameter=1c.processes.detail[*],powershell.exe -NoProfile -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\script\1c_processes.ps1" "$1" "$2"

# === 1C SESSIONS ===
# Обнаружение сессий 1С
UserParameter=1c.sessions.discovery,powershell.exe -NoProfile -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\script\1c_sessions.ps1" discovery
# Количество сессий 1С
UserParameter=1c.sessions.count,powershell.exe -NoProfile -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\script\1c_sessions.ps1" count
# Детальная информация о сессии (параметры: тип, значение)
UserParameter=1c.sessions.detail[*],powershell.exe -NoProfile -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\script\1c_sessions.ps1" "$1" "$2"
# Количество сессий по информационной базе
UserParameter=1c.sessions.by_infobase[*],powershell.exe -NoProfile -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\script\1c_sessions.ps1" count_by_infobase "$1"

# === 1C INFOBASES ===
# Обнаружение информационных баз 1С
UserParameter=1c.infobases.discovery,powershell.exe -NoProfile -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\script\1c_infobases.ps1" discovery
# Общее количество информационных баз
UserParameter=1c.infobases.count,powershell.exe -NoProfile -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\script\1c_infobases.ps1" total_count
# Количество сессий по информационной базе
UserParameter=1c.infobases.sessions[*],powershell.exe -NoProfile -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\script\1c_infobases.ps1" sessions_count "$1"
# Количество фоновых заданий по информационной базе
UserParameter=1c.infobases.jobs[*],powershell.exe -NoProfile -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\script\1c_infobases.ps1" background_jobs_count "$1"
# Статус запрета сессий для информационной базы
UserParameter=1c.infobases.deny.sessions[*],powershell.exe -NoProfile -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\script\1c_infobases.ps1" sessions_deny "$1"
# Статус запрета фоновых заданий для информационной базы
UserParameter=1c.infobases.deny.jobs[*],powershell.exe -NoProfile -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\script\1c_infobases.ps1" jobs_deny "$1"

# === 1C CLUSTER ===
# Мониторинг кластера 1С
# Количество процессов в кластере
UserParameter=1c.cluster.processes.count,powershell.exe -NoProfile -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\script\1c_cluster.ps1" processes_count
# Количество сессий в кластере
UserParameter=1c.cluster.sessions.count,powershell.exe -NoProfile -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\script\1c_cluster.ps1" sessions_count
# Количество информационных баз в кластере
UserParameter=1c.cluster.infobases.count,powershell.exe -NoProfile -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\script\1c_cluster.ps1" infobases_count
# Количество блокировок в кластере
UserParameter=1c.cluster.locks.count,powershell.exe -NoProfile -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\script\1c_cluster.ps1" locks_count
# Количество фоновых заданий в кластере
UserParameter=1c.cluster.jobs.count,powershell.exe -NoProfile -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\script\1c_cluster.ps1" background_jobs_count