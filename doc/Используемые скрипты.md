# ðŸ“Œ 1. Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÑ‚ÑÑ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ ÐµÐ´Ð¸Ð½Ñ‹Ð¹ Ñ„Ð°Ð¹Ð» ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸

**`C:\Program Files\Zabbix Agent\script\config\1c_config.psd1`**

Ð¡Ð¾Ð´ÐµÑ€Ð¶Ð¸Ð¼Ð¾Ðµ:

```powershell
@{
    RacPath     = "ÐŸÑƒÑ‚ÑŒ\Ðº\rac.exe"
    ClusterId   = "UUID ÐšÐ»Ð°ÑÑ‚ÐµÑ€Ð°"
    ClusterUser = "ÐÐ´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€ ÐºÐ»Ð°ÑÑ‚ÐµÑ€Ð°"
    ClusterPwd  = "ÐŸÐ°Ñ€Ð¾Ð»ÑŒ Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ð°"
    Server      = "localhost:1545"
    CacheDir    = "C:\Program Files\Zabbix Agent\script\cache"
}
```

> [!attention]
>
> ```powershell
> # Ð”Ð°ÐµÐ¼ Ð¿Ñ€Ð°Ð²Ð° Ð½Ð° Ñ‡Ñ‚ÐµÐ½Ð¸Ðµ Ð¸ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ Ð´Ð»Ñ rac.exe Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð°Ñ‚ÐµÐ»ÑŽ Ð¾Ñ‚ Ñ‡ÑŒÐµÐ³Ð¾ Ð¸Ð¼ÐµÐ½Ð¸ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½ Ð°Ð³ÐµÐ½Ñ‚ - Admin
> $acl = Get-Acl "C:\Program Files\1cv8\8.3.27.1786\bin\rac.exe"
> $accessRule = New-Object System.Security.AccessControl.FileSystemAccessRule("Admin", "ReadAndExecute", "Allow")
> $acl.SetAccessRule($accessRule)
> Set-Acl "C:\Program Files\1cv8\8.3.27.1786\bin\rac.exe" $acl
> Write-Host "ÐŸÑ€Ð°Ð²Ð° Ð½Ð° rac.exe Ð¿Ñ€ÐµÐ´Ð¾ÑÑ‚Ð°Ð²Ð»ÐµÐ½Ñ‹" -ForegroundColor Green
> 
> # Ð”Ð°ÐµÐ¼ Ð¿Ñ€Ð°Ð²Ð° Ð½Ð° Ð²ÑÑŽ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸ÑŽ 1cv8  Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð°Ñ‚ÐµÐ»ÑŽ Ð¾Ñ‚ Ñ‡ÑŒÐµÐ³Ð¾ Ð¸Ð¼ÐµÐ½Ð¸ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½ Ð°Ð³ÐµÐ½Ñ‚ - Admin
> $acl = Get-Acl "C:\Program Files\1cv8"
> $accessRule = New-Object System.Security.AccessControl.FileSystemAccessRule("Admin", "ReadAndExecute", "ContainerInherit,ObjectInherit", "None", "Allow")
> $acl.SetAccessRule($accessRule)
> Set-Acl "C:\Program Files\1cv8" $acl
> Write-Host "ÐŸÑ€Ð°Ð²Ð° Ð½Ð° Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸ÑŽ 1cv8 Ð¿Ñ€ÐµÐ´Ð¾ÑÑ‚Ð°Ð²Ð»ÐµÐ½Ñ‹" -ForegroundColor Green
> 
> # Ð”Ð°ÐµÐ¼ Ð¿Ñ€Ð°Ð²Ð° Ð½Ð° Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸ÑŽ ÑÐºÑ€Ð¸Ð¿Ñ‚Ð¾Ð² Zabbix Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð°Ñ‚ÐµÐ»ÑŽ Ð¾Ñ‚ Ñ‡ÑŒÐµÐ³Ð¾ Ð¸Ð¼ÐµÐ½Ð¸ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½ Ð°Ð³ÐµÐ½Ñ‚ - Admin
> $acl = Get-Acl "C:\Program Files\Zabbix Agent\script"
> $accessRule = New-Object System.Security.AccessControl.FileSystemAccessRule("Admin", "FullControl", "ContainerInherit,ObjectInherit", "None", "Allow")
> $acl.SetAccessRule($accessRule)
> Set-Acl "C:\Program Files\Zabbix Agent\script" $acl
> Write-Host "ÐŸÑ€Ð°Ð²Ð° Ð½Ð° Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸ÑŽ ÑÐºÑ€Ð¸Ð¿Ñ‚Ð¾Ð² Ð¿Ñ€ÐµÐ´Ð¾ÑÑ‚Ð°Ð²Ð»ÐµÐ½Ñ‹" -ForegroundColor Green
> ```

---

## ðŸ“Œ 2. Ð¡ÐºÑ€Ð¸Ð¿Ñ‚Ñ‹ Powershell

### âœ… 1) 1c_infobases.ps1

```powershell
param ($Metric = $args[0])

# Ð—Ð°Ð³Ñ€ÑƒÐ¶Ð°ÐµÐ¼ ÐºÐ¾Ð½Ñ„Ð¸Ð³
$configPath = "C:\Program Files\Zabbix Agent\script\config\1c_config.psd1"
$CONFIG_1C = Import-PowerShellDataFile -Path $configPath

try {
    $Rac = $CONFIG_1C.RacPath
    $cluster = $CONFIG_1C.ClusterId
    $user = $CONFIG_1C.ClusterUser
    $pwd = $CONFIG_1C.ClusterPwd
    $server = $CONFIG_1C.Server

    switch ($Metric) {

        "total_count" {
            $result = & $Rac infobase summary list `
                --cluster=$cluster `
                --cluster-user=$user `
                --cluster-pwd=$pwd `
                $server 2>$null

            if ($LASTEXITCODE -ne 0 -or !$result) {
                Write-Output 0
                break
            }

            $count = ($result | Select-String "^\s*infobase\s*:").Count
            Write-Output $count
        }

        "discovery" {
            # Ð—Ð´ÐµÑÑŒ Ð¼Ð¾Ð¶Ð½Ð¾ Ð¿Ð¾Ð·Ð¶Ðµ Ð´Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð»Ð½Ð¾Ñ†ÐµÐ½Ð½Ñ‹Ð¹ LLD
            Write-Output '{"data":[]}'
        }

        default {
            Write-Output 0
        }
    }

}
catch {
    Write-Output 0
}
```

---

#### âœ… 2) 1c_processes.ps1

```powershell
param ($Metric = $args[0])

$configPath = "C:\Program Files\Zabbix Agent\script\config\1c_config.psd1"
$CONFIG_1C = Import-PowerShellDataFile -Path $configPath

try {
    $Rac = $CONFIG_1C.RacPath
    $cluster = $CONFIG_1C.ClusterId
    $user = $CONFIG_1C.ClusterUser
    $pwd = $CONFIG_1C.ClusterPwd
    $server = $CONFIG_1C.Server

    switch ($Metric) {

        "count" {
            $result = & $Rac process list `
                --cluster=$cluster `
                --cluster-user=$user `
                --cluster-pwd=$pwd `
                $server 2>$null

            if ($LASTEXITCODE -ne 0 -or !$result) {
                Write-Output 0
                break
            }

            $count = ($result | Select-String "^\s*process\s*:").Count
            Write-Output $count
        }

        "discovery" {
            Write-Output '{"data":[]}'
        }

        default {
            Write-Output 0
        }
    }

}
catch {
    Write-Output 0
}
```

---

#### âœ… 3) 1c_sessions.ps1

```powershell
param ($Metric = $args[0])

$configPath = "C:\Program Files\Zabbix Agent\script\config\1c_config.psd1"
$CONFIG_1C = Import-PowerShellDataFile -Path $configPath

try {
    $Rac = $CONFIG_1C.RacPath
    $cluster = $CONFIG_1C.ClusterId
    $user = $CONFIG_1C.ClusterUser
    $pwd = $CONFIG_1C.ClusterPwd
    $server = $CONFIG_1C.Server

    switch ($Metric) {

        "count" {
            $result = & $Rac session list `
                --cluster=$cluster `
                --cluster-user=$user `
                --cluster-pwd=$pwd `
                $server 2>$null

            if ($LASTEXITCODE -ne 0 -or !$result) {
                Write-Output 0
                break
            }

            $count = ($result | Select-String "^\s*session\s*:").Count
            Write-Output $count
        }

        "discovery" {
            Write-Output '{"data":[]}'
        }

        default {
            Write-Output 0
        }
    }

}
catch {
    Write-Output 0
}
```
