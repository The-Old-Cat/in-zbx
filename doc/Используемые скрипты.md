# –î–∞–Ω–Ω—ã–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ—Ç–æ—Ä—ã—Ö —Å—Ç—Ä–æ–∏—Ç—Å—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥, –ø–æ–ª—É—á–µ–Ω—ã –∏–∑ –≤–≤–æ–¥–∞ –∫–æ–º–º–∞–Ω–¥

```powershell

& "C:\Program Files\1cv8\8.3.27.1786\bin\rac.exe" infobase summary list --cluster=cluster-UUID --cluster-user=admin --cluster-pwd=password-admin "localhost:1545"

& "C:\Program Files\1cv8\8.3.27.1786\bin\rac.exe" connection --cluster=cluster-UUID list --cluster-user=admin --cluster-pwd=password-admin "localhost:1545"

& "C:\Program Files\1cv8\8.3.27.1786\bin\rac.exe" cluster list

& "C:\Program Files\1cv8\8.3.27.1786\bin\rac.exe" session --cluster=cluster-UUID list --cluster-user=admin --cluster-pwd=password-admin "localhost:1545"

$result = & "C:\Program Files\1cv8\8.3.27.1786\bin\rac.exe" lock --cluster=cluster-UUID list --cluster-user=admin --cluster-pwd=password-admin "localhost:1545"
$result | Select-String -Pattern "lock|connection|session|dbpid|object"

& "C:\Program Files\1cv8\8.3.27.1786\bin\rac.exe" process --cluster=cluster-UUID list --cluster-user=admin --cluster-pwd=password-admin "localhost:1545"

& "C:\Program Files\1cv8\8.3.27.1786\bin\rac.exe" lock --cluster=cluster-UUID list --cluster-user=admin --cluster-pwd=password-admin "localhost:1545"

& "C:\Program Files\1cv8\8.3.27.1786\bin\rac.exe" counter --cluster=cluster-UUID list --cluster-user=admin --cluster-pwd=password-admin "localhost:1545"

```

## üìå –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–¥–∏–Ω—ã–π —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

**`C:\Program Files\Zabbix Agent\script\config\1c_config.psd1`**

–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:

```powershell
@{
    RacPath     = "–ü—É—Ç—å\–∫\rac.exe"
    ClusterId   = "UUID –ö–ª–∞—Å—Ç–µ—Ä–∞"
    ClusterUser = "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –∫–ª–∞—Å—Ç–µ—Ä–∞"
    ClusterPwd  = "–ü–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞"
    Server      = "localhost:1545"
    CacheDir    = "C:\Program Files\Zabbix Agent\script\cache"
}
```

> [!attention]
>
> ```powershell
> # –î–∞–µ–º –ø—Ä–∞–≤–∞ –Ω–∞ —á—Ç–µ–Ω–∏–µ –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–ª—è rac.exe –ø–æ–ª—å–∑–æ–∞—Ç–µ–ª—é –æ—Ç —á—å–µ–≥–æ –∏–º–µ–Ω–∏ –∑–∞–ø—É—â–µ–Ω –∞–≥–µ–Ω—Ç - Admin
> $acl = Get-Acl "C:\Program Files\1cv8\8.3.27.1786\bin\rac.exe"
> $accessRule = New-Object System.Security.AccessControl.FileSystemAccessRule("Admin", "ReadAndExecute", "Allow")
> $acl.SetAccessRule($accessRule)
> Set-Acl "C:\Program Files\1cv8\8.3.27.1786\bin\rac.exe" $acl
> Write-Host "–ü—Ä–∞–≤–∞ –Ω–∞ rac.exe –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω—ã" -ForegroundColor Green
> 
> # –î–∞–µ–º –ø—Ä–∞–≤–∞ –Ω–∞ –≤—Å—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é 1cv8  –ø–æ–ª—å–∑–æ–∞—Ç–µ–ª—é –æ—Ç —á—å–µ–≥–æ –∏–º–µ–Ω–∏ –∑–∞–ø—É—â–µ–Ω –∞–≥–µ–Ω—Ç - Admin
> $acl = Get-Acl "C:\Program Files\1cv8"
> $accessRule = New-Object System.Security.AccessControl.FileSystemAccessRule("Admin", "ReadAndExecute", "ContainerInherit,ObjectInherit", "None", "Allow")
> $acl.SetAccessRule($accessRule)
> Set-Acl "C:\Program Files\1cv8" $acl
> Write-Host "–ü—Ä–∞–≤–∞ –Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é 1cv8 –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω—ã" -ForegroundColor Green
> 
> # –î–∞–µ–º –ø—Ä–∞–≤–∞ –Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é —Å–∫—Ä–∏–ø—Ç–æ–≤ Zabbix –ø–æ–ª—å–∑–æ–∞—Ç–µ–ª—é –æ—Ç —á—å–µ–≥–æ –∏–º–µ–Ω–∏ –∑–∞–ø—É—â–µ–Ω –∞–≥–µ–Ω—Ç - Admin
> $acl = Get-Acl "C:\Program Files\Zabbix Agent\script"
> $accessRule = New-Object System.Security.AccessControl.FileSystemAccessRule("Admin", "FullControl", "ContainerInherit,ObjectInherit", "None", "Allow")
> $acl.SetAccessRule($accessRule)
> Set-Acl "C:\Program Files\Zabbix Agent\script" $acl
> Write-Host "–ü—Ä–∞–≤–∞ –Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é —Å–∫—Ä–∏–ø—Ç–æ–≤ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω—ã" -ForegroundColor Green
> ```

---

## üìå–°–∫—Ä–∏–ø—Ç—ã Powershell

### ‚úÖ 1. 1c_infobases.ps1

```powershell
param ($Metric = $args[0])

# –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ñ–∏–≥
$configPath = "C:\Program Files\Zabbix Agent\script\config\1c_config.psd1"
$CONFIG_1C = Import-PowerShellDataFile -Path $configPath

try {
    $Rac = $CONFIG_1C.RacPath
    $cluster = $CONFIG_1C.ClusterId
    $user = $CONFIG_1C.ClusterUser
    $pwd = $CONFIG_1C.ClusterPwd
    $server = $CONFIG_1C.Server

    switch ($Metric) {
        # -------------------------------------------------------
        # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã—Ö –±–∞–∑
        # -------------------------------------------------------
        "count" {
            $result = & $Rac infobase summary list `
                --cluster=$cluster `
                --cluster-user=$user `
                --cluster-pwd=$pwd `
                $server 2>$null

            if ($LASTEXITCODE -ne 0 -or !$result) {
                Write-Output 0
                break
            }

            $count = ($result | Select-String "^\s*infobase\s*:").Count
            Write-Output $count
        }

        default {
            Write-Output 0
        }
    }

}
catch {
    Write-Output 0
}

```

---

### ‚úÖ 2. 1c_processes.ps1

```powershell
param ($Metric = $args[0])

$configPath = "C:\Program Files\Zabbix Agent\script\config\1c_config.psd1"
$CONFIG_1C = Import-PowerShellDataFile -Path $configPath

try {
    $Rac = $CONFIG_1C.RacPath
    $cluster = $CONFIG_1C.ClusterId
    $user = $CONFIG_1C.ClusterUser
    $pwd = $CONFIG_1C.ClusterPwd
    $server = $CONFIG_1C.Server

    switch ($Metric) {
        # -------------------------------------------------------
        # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞–±–æ—á–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
        # -------------------------------------------------------
        "count" {
            $result = & $Rac process list `
                --cluster=$cluster `
                --cluster-user=$user `
                --cluster-pwd=$pwd `
                $server 2>$null

            if ($LASTEXITCODE -ne 0 -or !$result) {
                Write-Output 0
                break
            }

            $count = ($result | Select-String "^\s*process\s*:").Count
            Write-Output $count
        }

        default {
            Write-Output 0
        }
    }

}
catch {
    Write-Output 0
}

```

---

### ‚úÖ 3. 1c_sessions.ps1

```powershell
param ($Metric = $args[0])

# –ü—É—Ç—å –∫ –∫–æ–Ω—Ñ–∏–≥—É
$configPath = "C:\Program Files\Zabbix Agent\script\config\1c_config.psd1"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
if (-not (Test-Path $configPath)) {
    Write-Output 0
    exit
}

# –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
$CONFIG_1C = Import-PowerShellDataFile -Path $configPath

# –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
$Rac     = $CONFIG_1C.RacPath
$cluster = $CONFIG_1C.ClusterId
$user    = $CONFIG_1C.ClusterUser
$pwd     = $CONFIG_1C.ClusterPwd
$server  = $CONFIG_1C.Server

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è rac.exe
if (-not (Test-Path $Rac)) {
    Write-Output 0
    exit
}

try {
    switch ($Metric) {

        # -------------------------------------------------------
        # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–µ—Å—Å–∏–π
        # -------------------------------------------------------
        "count" {

            $result = & $Rac session list `
                --cluster=$cluster `
                --cluster-user=$user `
                --cluster-pwd=$pwd `
                $server 2>$null

            if ($LASTEXITCODE -ne 0 -or !$result) {
                Write-Output 0
                break
            }

            $count = ($result | Select-String "^\s*session\s*:").Count
            Write-Output $count
        }
        
        default {
            Write-Output 0
        }
    }

}
catch {
    Write-Output 0
}

```

### 4. 1c_processes_lld.ps1

```powershell

param($Metric = $args[0])

try {
    # ----------------------------------------------------
    # –ü—É—Ç—å –∫ –∫–æ–Ω—Ñ–∏–≥—É
    # ----------------------------------------------------
    $configPath = "C:\Program Files\Zabbix Agent\script\config\1c_config.psd1"

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
    if (-not (Test-Path $configPath)) {
        Write-Output '{"data":[]}'
        exit
    }

    # –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
    $CONFIG_1C = Import-PowerShellDataFile -Path $configPath

    # –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
    $RacPath = $CONFIG_1C.RacPath
    $ClusterId = $CONFIG_1C.ClusterId
    $ClusterUser = $CONFIG_1C.ClusterUser
    $ClusterPwd = $CONFIG_1C.ClusterPwd
    $Server = $CONFIG_1C.Server


    # ----------------------------------------------------
    # LLD discovery
    # ----------------------------------------------------
    if ($Metric -eq "discovery") {

        $result = & $RacPath process list --cluster=$ClusterId --cluster-user=$ClusterUser --cluster-pwd=$ClusterPwd $Server 2>$null
        
        if ($LASTEXITCODE -eq 0 -and $result -ne $null) {

            $processes = @()
            $currentProcess = @{}

            foreach ($line in $result) {
                if ($line -eq $null) { continue }
                $line = $line.Trim()

                # –∫–æ–Ω–µ—Ü –±–ª–æ–∫–∞ –æ–¥–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞
                if ($line -eq "" -and $currentProcess.Count -gt 0) {

                    if ($currentProcess.process -and $currentProcess.port) {

                        $lldObject = @{
                            "{#HOST}"                 = if ($currentProcess.ContainsKey("host")) { $currentProcess["host"] } else { "unknown" }
                            "{#PORT}"                 = if ($currentProcess.ContainsKey("port")) { $currentProcess["port"] } else { "0" }
                            "{#PID}"                  = if ($currentProcess.ContainsKey("pid")) { $currentProcess["pid"] } else { "0" }
                            "{#TURNED_ON}"            = if ($currentProcess.ContainsKey("turned-on")) { $currentProcess["turned-on"] } else { "unknown" }
                            "{#RUNNING}"              = if ($currentProcess.ContainsKey("running")) { $currentProcess["running"] } else { "unknown" }
                            "{#STARTED_AT}"           = if ($currentProcess.ContainsKey("started-at")) { $currentProcess["started-at"] } else { "unknown" }
                            "{#USE}"                  = if ($currentProcess.ContainsKey("use")) { $currentProcess["use"] } else { "unknown" }
                            "{#AVAILABLE_PERFOMANCE}" = if ($currentProcess.ContainsKey("available-perfomance")) { $currentProcess["available-perfomance"] } else { "0" }
                            "{#CAPACITY}"             = if ($currentProcess.ContainsKey("capacity")) { $currentProcess["capacity"] } else { "0" }
                            "{#CONNECTIONS}"          = if ($currentProcess.ContainsKey("connections")) { $currentProcess["connections"] } else { "0" }
                            "{#MEMORY_SIZE}"          = if ($currentProcess.ContainsKey("memory-size")) { $currentProcess["memory-size"] } else { "0" }
                            "{#AVG_CALL_TIME}"        = if ($currentProcess.ContainsKey("avg-call-time")) { $currentProcess["avg-call-time"] } else { "0" }
                            "{#AVG_DB_CALL_TIME}"     = if ($currentProcess.ContainsKey("avg-db-call-time")) { $currentProcess["avg-db-call-time"] } else { "0" }
                            "{#AVG_LOCK_CALL_TIME}"   = if ($currentProcess.ContainsKey("avg-lock-call-time")) { $currentProcess["avg-lock-call-time"] } else { "0" }
                            "{#AVG_SERVER_CALL_TIME}" = if ($currentProcess.ContainsKey("avg-server-call-time")) { $currentProcess["avg-server-call-time"] } else { "0" }
                        }

                        $processes += $lldObject
                    }

                    $currentProcess = @{}
                }
                elseif ($line -match "^([\w-]+)\s*:\s*(.+)") {
                    $key = $matches[1].Trim()
                    $value = $matches[2].Trim()
                    $currentProcess[$key] = $value
                }
            }

            # –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –±–ª–æ–∫–∞
            if ($currentProcess.process -and $currentProcess.port) {
                $lldObject = @{
                    "{#HOST}"                 = if ($currentProcess.ContainsKey("host")) { $currentProcess["host"] } else { "unknown" }
                    "{#PORT}"                 = if ($currentProcess.ContainsKey("port")) { $currentProcess["port"] } else { "0" }
                    "{#PID}"                  = if ($currentProcess.ContainsKey("pid")) { $currentProcess["pid"] } else { "0" }
                    "{#TURNED_ON}"            = if ($currentProcess.ContainsKey("turned-on")) { $currentProcess["turned-on"] } else { "unknown" }
                    "{#RUNNING}"              = if ($currentProcess.ContainsKey("running")) { $currentProcess["running"] } else { "unknown" }
                    "{#STARTED_AT}"           = if ($currentProcess.ContainsKey("started-at")) { $currentProcess["started-at"] } else { "unknown" }
                    "{#USE}"                  = if ($currentProcess.ContainsKey("use")) { $currentProcess["use"] } else { "unknown" }
                    "{#AVAILABLE_PERFOMANCE}" = if ($currentProcess.ContainsKey("available-perfomance")) { $currentProcess["available-perfomance"] } else { "0" }
                    "{#CAPACITY}"             = if ($currentProcess.ContainsKey("capacity")) { $currentProcess["capacity"] } else { "0" }
                    "{#CONNECTIONS}"          = if ($currentProcess.ContainsKey("connections")) { $currentProcess["connections"] } else { "0" }
                    "{#MEMORY_SIZE}"          = if ($currentProcess.ContainsKey("memory-size")) { $currentProcess["memory-size"] } else { "0" }
                    "{#AVG_CALL_TIME}"        = if ($currentProcess.ContainsKey("avg-call-time")) { $currentProcess["avg-call-time"] } else { "0" }
                    "{#AVG_DB_CALL_TIME}"     = if ($currentProcess.ContainsKey("avg-db-call-time")) { $currentProcess["avg-db-call-time"] } else { "0" }
                    "{#AVG_LOCK_CALL_TIME}"   = if ($currentProcess.ContainsKey("avg-lock-call-time")) { $currentProcess["avg-lock-call-time"] } else { "0" }
                    "{#AVG_SERVER_CALL_TIME}" = if ($currentProcess.ContainsKey("avg-server-call-time")) { $currentProcess["avg-server-call-time"] } else { "0" }
                }

                $processes += $lldObject
            }

            $json = @{ data = $processes } | ConvertTo-Json -Compress
            Write-Output $json
        }
        else {
            Write-Output '{"data":[]}'
        }
    }
    else {
        Write-Output '{"data":[]}'
    }
}
catch {
    Write-Output '{"data":[]}'
}


```

### 5. 1c_processes_detail.ps1

```powershell

param(
    [string]$Port = $args[0],      # –ü–æ—Ä—Ç –ø—Ä–æ—Ü–µ—Å—Å–∞ 1–°
    [string]$Metric = $args[1]    # –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º–∞—è –º–µ—Ç—Ä–∏–∫–∞
)

function Get-ProcessMetric {
    param (
        [hashtable]$ProcessData,
        [string]$Metric
    )

    switch ($Metric) {
        "connections" {
            return Parse-IntegerValue -Data $ProcessData -Key "connections"
        }
        "memory_size" {
            return Parse-MemoryValue -Data $ProcessData -Key "memory-size"
        }
        "avg_call_time" {
            return Parse-FloatValue -Data $ProcessData -Key "avg-call-time"
        }
        "avg_db_call_time" {
            return Parse-FloatValue -Data $ProcessData -Key "avg-db-call-time"
        }
        "avg_lock_call_time" {
            return Parse-FloatValue -Data $ProcessData -Key "avg-lock-call-time"
        }
        "avg_server_call_time" {
            return Parse-FloatValue -Data $ProcessData -Key "avg-server-call-time"
        }
        "available_perfomance" {
            return Parse-IntegerValue -Data $ProcessData -Key "available-perfomance"
        }
        "windows_memory" {
            return Get-WindowsMemory -ProcessData $ProcessData
        }
        default {
            return 0
        }
    }
}

function Parse-IntegerValue {
    param (
        [hashtable]$Data,
        [string]$Key
    )
    if ($Data.ContainsKey($Key) -and $Data[$Key] -match '^\d+$') {
        return [int]$Data[$Key]
    }
    return 0
}

function Parse-FloatValue {
    param (
        [hashtable]$Data,
        [string]$Key
    )
    if ($Data.ContainsKey($Key) -and $Data[$Key] -match '^\d+(\.\d+)?$') {
        $value = [double]$Data[$Key]
        return $value.ToString("F", [cultureinfo]::InvariantCulture)
    }
    return 0
}

function Parse-MemoryValue {
    param (
        [hashtable]$Data,
        [string]$Key
    )
    if ($Data.ContainsKey($Key) -and $Data[$Key] -match '^\d+$') {
        $value = [math]::Round([long]$Data[$Key] / 1MB, 2)
        return $value.ToString("F", [cultureinfo]::InvariantCulture)
    }
    return 0
}

function Get-WindowsMemory {
    param (
        [hashtable]$ProcessData
    )
    if ($ProcessData.ContainsKey("pid") -and $ProcessData["pid"] -match '^\d+$') {
        $ProcessID = [int]$ProcessData["pid"]
        $process = Get-Process -Id $ProcessID -ErrorAction SilentlyContinue
        if ($process) {
            $workingSet = [math]::Round($process.WorkingSet64 , 2)
            if ($workingSet -ge 1024) {
                $valueInGB = [math]::Round($workingSet / 1GB , 2)
                return $valueInGB.ToString("F", [cultureinfo]::InvariantCulture)
            } else {
                return $workingSet.ToString("F", [cultureinfo]::InvariantCulture)
            }
        }
    }
    return 0
}

try {
    # ----------------------------------------------------
    # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è RAC
    # ----------------------------------------------------
    $configPath = "C:\Program Files\Zabbix Agent\script\config\1c_config.psd1"

    if (-not (Test-Path $configPath)) {
        Write-Output 0
        return
    }

    $CONFIG_1C = Import-PowerShellDataFile -Path $configPath

    $RacPath     = $CONFIG_1C.RacPath
    $ClusterId   = $CONFIG_1C.ClusterId
    $ClusterUser = $CONFIG_1C.ClusterUser
    $ClusterPwd  = $CONFIG_1C.ClusterPwd
    $Server      = $CONFIG_1C.Server

    if (-not $Port -or -not $Metric) {
        Write-Output 0
        return
    }

    # ----------------------------------------------------
    # –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ 1–° —á–µ—Ä–µ–∑ rac
    # ----------------------------------------------------
    $result = & $RacPath process list --cluster=$ClusterId --cluster-user=$ClusterUser --cluster-pwd=$ClusterPwd $Server 2>$null
    
    if ($LASTEXITCODE -ne 0 -or $result -eq $null) {
        Write-Output 0
        return
    }

    $processData = @{}
    $currentProcess = @{}

    foreach ($line in $result) {
        if ($line -eq $null) { continue }
        $line = $line.Trim()

        # –ö–æ–Ω–µ—Ü –±–ª–æ–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞
        if ($line -eq "" -and $currentProcess.Count -gt 0) {
            if ($currentProcess.port -eq $Port) {
                $processData = $currentProcess.Clone()
                break
            }
            $currentProcess = @{}
        }
        elseif ($line -match "^([\w-]+)\s*:\s*(.+)") {
            $key = $matches[1].Trim()
            $value = $matches[2].Trim()
            $currentProcess[$key] = $value
        }
    }

    if ($currentProcess.Count -gt 0 -and $currentProcess.port -eq $Port) {
        $processData = $currentProcess.Clone()
    }

    if ($processData.Count -eq 0) {
        Write-Output 0
        return
    }

    # ----------------------------------------------------
    # –ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫–∏
    # ----------------------------------------------------
    Write-Output (Get-ProcessMetric -ProcessData $processData -Metric $Metric)
}
catch {
    Write-Output ("Error in metric '{0}' for port '{1}': {2}" -f $Metric, $Port, $_)
}

```

### 6. 1c_infobases_lld.ps1

```powershell
# –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∫–∞–∫: 1c_infobases_lld.ps1
param($Metric = $args[0])

try {
     # ----------------------------------------------------
    # –ü—É—Ç—å –∫ –∫–æ–Ω—Ñ–∏–≥—É
    # ----------------------------------------------------
    $configPath = "C:\Program Files\Zabbix Agent\script\config\1c_config.psd1"

   # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
   if (-not (Test-Path $configPath)) {
    Write-Output '{"data":[]}'
    exit
    }

    # –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
    $CONFIG_1C = Import-PowerShellDataFile -Path $configPath

    # –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
    $RacPath = $CONFIG_1C.RacPath
    $ClusterId = $CONFIG_1C.ClusterId
    $ClusterUser = $CONFIG_1C.ClusterUser
    $ClusterPwd = $CONFIG_1C.ClusterPwd
    $Server = $CONFIG_1C.Server

    # ----------------------------------------------------
    # LLD discovery
    # ----------------------------------------------------
    if ($Metric -eq "discovery") {
        $result = & $RacPath infobase summary list --cluster=$ClusterId --cluster-user=$ClusterUser --cluster-pwd=$ClusterPwd $Server 2>$null
        
        if ($LASTEXITCODE -eq 0 -and $result -ne $null) {
            $infobases = @()
            $currentInfobase = @{}
            
            foreach ($line in $result) {
                if ($line -eq $null) { continue }
                $line = $line.Trim()
                
                if ($line -eq "" -and $currentInfobase.Count -gt 0) {
                    if ($currentInfobase.infobase -and $currentInfobase.name) {
                        $infobases += @{
                            "{#IBNAME}" = $currentInfobase.name
                            
                        }
                    }
                    $currentInfobase = @{}
                }
                elseif ($line -match "^([\w-]+)\s*:\s*(.+)") {
                    $key = $matches[1].Trim()
                    $value = $matches[2].Trim()
                    $currentInfobase[$key] = $value
                }
            }
            
            # –î–æ–±–∞–≤–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é –∏–Ω—Ñ–æ–±–∞–∑—É
            if ($currentInfobase.infobase -and $currentInfobase.name) {
                $infobases += @{
                    "{#IBNAME}" = $currentInfobase.name
                    
                }
            }
            
            $json = @{data = $infobases} | ConvertTo-Json -Compress
            Write-Output $json
        } else {
            Write-Output '{"data":[]}'
        }
    }
    else {
        Write-Output '{"data":[]}'
    }
}
catch {
    Write-Output '{"data":[]}'
}
```

### 7. 1c_infobases_list.ps1

```powershell

# –û–±—ë—Ä—Ç–∫–∞ –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è JSON –≤ —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Å–ø–∏—Å–æ–∫
$json = & "C:\Program Files\Zabbix Agent\script\1c_infobases_lld.ps1" "discovery" | ConvertFrom-Json

foreach ($item in $json.data) {
    Write-Output $item.'{#IBNAME}'
}

```
