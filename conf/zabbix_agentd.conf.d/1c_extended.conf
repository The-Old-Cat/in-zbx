
############### 1C log Monitoring ################
UserParameter=1c.logs.LLD,powershell.exe -NoProfile -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\script\monitor_1c.ps1" LLD "E:\1c_log"

# Для calls
UserParameter=1c.calls[*],powershell.exe -NoProfile -ExecutionPolicy Bypass -Command "try { & 'C:\Program Files\Zabbix Agent\script\monitor_1c.ps1' calls 'E:\1c_log' '$1' '$2' } catch { Write-Output '{\"data\":[]}' }"

# Для locks
UserParameter=1c.locks[*],powershell.exe -NoProfile -ExecutionPolicy Bypass -Command "try { & 'C:\Program Files\Zabbix Agent\script\monitor_1c.ps1' locks 'E:\1c_log' '$1' } catch { Write-Output '{\"data\":[]}' }"

# === TOP 5 LOCK COUNTS ===
# Top 1
UserParameter=1c.locks.top1.count,powershell.exe -NoProfile -ExecutionPolicy Bypass -Command "$r = & 'C:\Program Files\Zabbix Agent\script\monitor_1c.ps1' locks 'E:\1c_log' '1' 2>$null; try { $j = $r | ConvertFrom-Json; if ($j.data.Count -gt 0) { [int]$j.data[0].'{#COUNT' } else { 0 } } catch { 0 }"

# Top 2
UserParameter=1c.locks.top2.count,powershell.exe -NoProfile -ExecutionPolicy Bypass -Command "$r = & 'C:\Program Files\Zabbix Agent\script\monitor_1c.ps1' locks 'E:\1c_log' '2' 2>$null; try { $j = $r | ConvertFrom-Json; if ($j.data.Count -gt 1) { [int]$j.data[1].'{#COUNT' } else { 0 } } catch { 0 }"

# Top 3
UserParameter=1c.locks.top3.count,powershell.exe -NoProfile -ExecutionPolicy Bypass -Command "$r = & 'C:\Program Files\Zabbix Agent\script\monitor_1c.ps1' locks 'E:\1c_log' '3' 2>$null; try { $j = $r | ConvertFrom-Json; if ($j.data.Count -gt 2) { [int]$j.data[2].'{#COUNT' } else { 0 } } catch { 0 }"

# Top 4
UserParameter=1c.locks.top4.count,powershell.exe -NoProfile -ExecutionPolicy Bypass -Command "$r = & 'C:\Program Files\Zabbix Agent\script\monitor_1c.ps1' locks 'E:\1c_log' '4' 2>$null; try { $j = $r | ConvertFrom-Json; if ($j.data.Count -gt 3) { [int]$j.data[3].'{#COUNT' } else { 0 } } catch { 0 }"

# Top 5
UserParameter=1c.locks.top5.count,powershell.exe -NoProfile -ExecutionPolicy Bypass -Command "$r = & 'C:\Program Files\Zabbix Agent\script\monitor_1c.ps1' locks 'E:\1c_log' '5' 2>$null; try { $j = $r | ConvertFrom-Json; if ($j.data.Count -gt 4) { [int]$j.data[4].'{#COUNT' } else { 0 } } catch { 0 }"

# === TOP 5 REGION NAMES ===
UserParameter=1c.locks.top1.region,powershell.exe -NoProfile -ExecutionPolicy Bypass -Command "try { $j = & 'C:\Program Files\Zabbix Agent\script\monitor_1c.ps1' locks 'E:\1c_log' '5'; $d = ($j | ConvertFrom-Json).data; if ($d.Count -gt 0) { $d[0]['{#REGION}'] } else { 'unknown' } } catch { 'unknown' }"
UserParameter=1c.locks.top2.region,powershell.exe -NoProfile -ExecutionPolicy Bypass -Command "try { $j = & 'C:\Program Files\Zabbix Agent\script\monitor_1c.ps1' locks 'E:\1c_log' '5'; $d = ($j | ConvertFrom-Json).data; if ($d.Count -gt 1) { $d[1]['{#REGION}'] } else { 'unknown' } } catch { 'unknown' }"
UserParameter=1c.locks.top3.region,powershell.exe -NoProfile -ExecutionPolicy Bypass -Command "try { $j = & 'C:\Program Files\Zabbix Agent\script\monitor_1c.ps1' locks 'E:\1c_log' '5'; $d = ($j | ConvertFrom-Json).data; if ($d.Count -gt 2) { $d[2]['{#REGION}'] } else { 'unknown' } } catch { 'unknown' }"
UserParameter=1c.locks.top4.region,powershell.exe -NoProfile -ExecutionPolicy Bypass -Command "try { $j = & 'C:\Program Files\Zabbix Agent\script\monitor_1c.ps1' locks 'E:\1c_log' '5'; $d = ($j | ConvertFrom-Json).data; if ($d.Count -gt 3) { $d[3]['{#REGION}'] } else { 'unknown' } } catch { 'unknown' }"
UserParameter=1c.locks.top5.region,powershell.exe -NoProfile -ExecutionPolicy Bypass -Command "try { $j = & 'C:\Program Files\Zabbix Agent\script\monitor_1c.ps1' locks 'E:\1c_log' '5'; $d = ($j | ConvertFrom-Json).data; if ($d.Count -gt 4) { $d[4]['{#REGION}'] } else { 'unknown' } } catch { 'unknown' }"

# Для excps
UserParameter=1c.excps[*],powershell.exe -NoProfile -ExecutionPolicy Bypass -Command "try { & 'C:\Program Files\Zabbix Agent\script\monitor_1c.ps1' excps 'E:\1c_log' '$1' } catch { Write-Output '{\"data\":[]}' }"




############### 1C RAC Monitoring ################
# 1C PROCESSES
UserParameter=1c.processes.discovery,powershell.exe -NoProfile -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\script\1c_processes_lld.ps1" discovery
UserParameter=1c.processes.count,powershell.exe -NoProfile -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\script\1c_processes.ps1" count
UserParameter=1c.processes.detail[*],powershell.exe -NoProfile -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\script\1c_processes_detail.ps1" "$1" "$2"

# 1C INFOBASES
UserParameter=1c.infobases.discovery,powershell.exe -NoProfile -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\script\1c_infobases_lld.ps1" discovery
UserParameter=1c.infobases.count,powershell.exe -NoProfile -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\script\1c_infobases.ps1" count
UserParameter=1c.infobases.list,powershell.exe -NoProfile -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\script\1c_infobases_list.ps1"


# 1C SESSIONS
UserParameter=1c.sessions.discovery,powershell.exe -NoProfile -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\script\1c_sessions.ps1" discovery
UserParameter=1c.sessions.count,powershell.exe -NoProfile -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\script\1c_sessions.ps1" count
UserParameter=1c.sessions.sysbg.count,powershell.exe -NoProfile -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\script\1c_sessions.ps1" sysbg.count
UserParameter=1c.sessions.bg.count,powershell.exe -NoProfile -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\script\1c_sessions.ps1" bg.count

# 1C CLUSTER
UserParameter=1c.cluster.processes.count,powershell.exe -NoProfile -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\script\1c_cluster.ps1" processes_count
UserParameter=1c.cluster.sessions.count,powershell.exe -NoProfile -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\script\1c_cluster.ps1" sessions_count
UserParameter=1c.cluster.infobases.count,powershell.exe -NoProfile -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\script\1c_cluster.ps1" infobases_count
